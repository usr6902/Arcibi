<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Merge Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            overflow: hidden;
        }
        #score-container {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        #game-container {
            display: grid;
            grid-template-columns: repeat(5, 60px);
            grid-template-rows: repeat(5, 60px);
            gap: 5px;
            touch-action: none;
            position: relative;
        }
        .tile {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            background-color: #d3d3d3;
            user-select: none;
        }
        .red { background-color: red; color: white; }
        .green { background-color: green; color: white; }
        .blue { background-color: blue; color: white; }
        .yellow { background-color: yellow; color: black; }
        .cyan { background-color: cyan; color: black; }
        .magenta { background-color: magenta; color: black; }
        .white { background-color: white; color: black; }
        .confetti {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            animation: fade-out 1s forwards;
        }
        @keyframes fade-out {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
        .score-animation {
            position: absolute;
            font-size: 20px;
            font-weight: bold;
            color: black;
            animation: move-to-score 1s forwards;
        }
        @keyframes move-to-score {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100px); }
        }
    </style>
</head>
<body>
    <div id="score-container">Score: 0</div>
    <div id="game-container"></div>
    <script>
        const colors = ["red", "green", "blue"];
        const colorLabels = {
            "red": "R",
            "green": "G",
            "blue": "B",
            "yellow": "RG",
            "cyan": "GB",
            "magenta": "RB",
            "white": "RGB"
        };
        const mixColors = {
            "red+green": "yellow",
            "green+red": "yellow",
            "red+blue": "magenta",
            "blue+red": "magenta",
            "green+blue": "cyan",
            "blue+green": "cyan",
        };
        let grid = Array(5).fill().map(() => Array(5).fill(null));
        let score = 0;

        function randomColor() {
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function spawnTile() {
            let emptyTiles = [];
            for (let r = 0; r < 5; r++) {
                for (let c = 0; c < 5; c++) {
                    if (!grid[r][c]) emptyTiles.push([r, c]);
                }
            }
            if (emptyTiles.length > 0) {
                const [r, c] = emptyTiles[Math.floor(Math.random() * emptyTiles.length)];
                grid[r][c] = randomColor();
            }
        }

        function drawGrid() {
            const container = document.getElementById("game-container");
            container.innerHTML = "";
            for (let r = 0; r < 5; r++) {
                for (let c = 0; c < 5; c++) {
                    const tile = document.createElement("div");
                    tile.classList.add("tile");
                    if (grid[r][c]) {
                        tile.classList.add(grid[r][c]);
                        tile.textContent = colorLabels[grid[r][c]];
                    }
                    tile.dataset.row = r;
                    tile.dataset.col = c;
                    container.appendChild(tile);
                }
            }
        }

        function merge(row) {
            let newRow = row.filter(tile => tile !== null);
            for (let i = 0; i < newRow.length - 1; i++) {
                const pair = `${newRow[i]}+${newRow[i+1]}`;
                if (mixColors[pair]) {
                    newRow[i] = mixColors[pair];
                    newRow[i+1] = null;
                    if (newRow[i] === "white") {
                        handleWhiteTile(i, row.indexOf(newRow[i]));
                        newRow[i] = null;
                    }
                }
            }
            return newRow.filter(tile => tile !== null).concat(Array(5 - newRow.length).fill(null));
        }

        function moveLeft() {
            let moved = false;
            for (let r = 0; r < 5; r++) {
                let original = [...grid[r]];
                grid[r] = merge(grid[r]);
                if (original.toString() !== grid[r].toString()) moved = true;
            }
            return moved;
        }

        function moveRight() {
            let moved = false;
            for (let r = 0; r < 5; r++) {
                let original = [...grid[r]];
                grid[r] = merge(grid[r].reverse()).reverse();
                if (original.toString() !== grid[r].toString()) moved = true;
            }
            return moved;
        }

        function moveUp() {
            let moved = false;
            for (let c = 0; c < 5; c++) {
                let column = [];
                for (let r = 0; r < 5; r++) column.push(grid[r][c]);
                let original = [...column];
                column = merge(column);
                for (let r = 0; r < 5; r++) grid[r][c] = column[r];
                if (original.toString() !== column.toString()) moved = true;
            }
            return moved;
        }

        function moveDown() {
            let moved = false;
            for (let c = 0; c < 5; c++) {
                let column = [];
                for (let r = 0; r < 5; r++) column.push(grid[r][c]);
                let original = [...column];
                column = merge(column.reverse()).reverse();
                for (let r = 0; r < 5; r++) grid[r][c] = column[r];
                if (original.toString() !== column.toString()) moved = true;
            }
            return moved;
        }

        let startX, startY, endX, endY;

        function handleTouchStart(e) {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        }

        function handleTouchEnd(e) {
            endX = e.changedTouches[0].clientX;
            endY = e.changedTouches[0].clientY;
            handleSwipe();
        }

        function handleSwipe() {
            const dx = endX - startX;
            const dy = endY - startY;

            if (Math.abs(dx) > Math.abs(dy)) {
                if (dx > 0) {
                    if (moveRight()) afterMove();
                } else {
                    if (moveLeft()) afterMove();
                }
            } else {
                if (dy > 0) {
                    if (moveDown()) afterMove();
                } else {
                    if (moveUp()) afterMove();
                }
            }
        }
function handleWhiteTile(row, col) {
    const container = document.getElementById("game-container");
    const confetti = document.createElement("div");
    confetti.classList.add("confetti");
    confetti.style.top = `${row * 60}px`;
    confetti.style.left = `${col * 60}px`;

    const scoreAnimation = document.createElement("div");
    scoreAnimation.classList.add("score-animation");
    scoreAnimation.textContent = "+300";
    scoreAnimation.style.top = `${row * 60}px`;
    scoreAnimation.style.left = `${col * 60}px`;

    container.appendChild(confetti);
    container.appendChild(scoreAnimation);

    // Puanı hemen ekleyin
    score += 300;
    document.getElementById("score-container").textContent = `Score: ${score}`;
    
    setTimeout(() => {
        confetti.remove();
        scoreAnimation.remove();
        grid[row][col] = null;  // Tile'ı kaldırın
        drawGrid();  // Grid'i tekrar çizin
    }, 1000);  // Animasyon süresi
}
        function handleWhiteTile2(row, col) {
            const container = document.getElementById("game-container");
            const confetti = document.createElement("div");
            confetti.classList.add("confetti");
            confetti.style.top = `${row * 60}px`;
            confetti.style.left = `${col * 60}px`;

            const scoreAnimation = document.createElement("div");
            scoreAnimation.classList.add("score-animation");
            scoreAnimation.textContent = "+300";
            scoreAnimation.style.top = `${row * 60}px`;
            scoreAnimation.style.left = `${col * 60}px`;

            container.appendChild(confetti);
            container.appendChild(scoreAnimation);

            setTimeout(() => {
                confetti.remove();
                scoreAnimation.remove();
                score += 300;
                grid[row][col] = null;
                drawGrid();
                document.getElementById("score-container").textContent = `Score: ${score}`;
            }, 1000);
        }

        function afterMove() {
            spawnTile();
            drawGrid();
        }

        function initGame() {
            spawnTile();
            spawnTile();
            drawGrid();
            document.addEventListener("touchstart", handleTouchStart);
            document.addEventListener("touchend", handleTouchEnd);
        }

        initGame();
    </script>
</body>
</html>
